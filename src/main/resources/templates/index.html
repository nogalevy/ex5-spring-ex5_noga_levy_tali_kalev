<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="en">

<head>
    <title>Jokes</title>
    <!-- Include Bootstrap CSS -->
    <!--    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">-->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <link rel="stylesheet" href="../static/style.css">
</head>
<script>
    document.addEventListener("DOMContentLoaded", () => {
        let addBtn = document.getElementById("addFavourite");
        addBtn.addEventListener("click", add);
        const card = document.getElementById('clickable');
        let cardbox = document.getElementById("cardBox");
        card.addEventListener('click', handleFlip)

        function handleFlip() {
            if(!card.classList.contains('flip-btn')) return;
            const f = document.getElementById('front')
            const b = document.getElementById('back')
            f.classList.toggle('flipped')
            b.classList.toggle('flipped')
        }

        // -----------------------------------
        let front = document.getElementById('frontCardContent'); //NOGA
        let back = document.getElementById('backCardContent'); //NOGA

        document.getElementById("generate").addEventListener("click", () => {
            fetch('/pages/getJokes')
                .then(response =>
                    response.json()
                )
                .then(jsonData => {
                    const f = document.getElementById('front')
                    const b = document.getElementById('back')
                    cardbox.setAttribute("name", jsonData.id);
                    addBtn.textContent = 'Add'; //NOGA : change icon + add listener
                    addBtn.addEventListener('click', add);
                    if(f.classList.contains('flipped')){
                        f.classList.toggle('flipped')
                        b.classList.toggle('flipped')
                    }
                    //TODO: add to constantnsnsts!
                    if (jsonData.type === "twopart") {
                        front.innerHTML = jsonData.setup;
                        back.innerHTML = jsonData.delivery;
                        card.classList.add('flip-btn');
                    }
                    else {
                        front.innerHTML = jsonData.joke;
                        back.innerHTML = "";
                        card.classList.remove('flip-btn')
                        card.classList.add('not-flip')
                    }
                })
                .catch(error => {
                    console.log(error);
                });
        });

        function add(){
            let jokeId = cardbox.getAttribute("name");
            fetch('/favourites/add', {
                    method: "POST",
                    headers: {"Content-Type": "application/json"},
                    body: jokeId
                }
            )
                .then(response =>
                {
                    addBtn.textContent = 'Added'; //NOGA : change icon + remove listener
                    addBtn.removeEventListener('click', add);
                    console.log(response);
                })
                .catch(error => {
                    console.log("could not add ", err);
                });
        }
    });
</script>

<body>
    <div class="container-fluid">
        <header th:insert="fragments/header.html :: header"> </header>

        <div class="d-flex flex-column align-items-center row">

            <div id="cardBox" th:name="${jokeObj.id}" th:insert="fragments/card2.html :: card2" class="col-md-6"></div>
            <div class="d-flex justify-content-evenly">
                <button id="generate" class="btn mx-2 mt-3" style="background-color: #575761; color: white;">Generate New</button>
                <button id="addFavourite" class="btn mx-2 mt-3" style="background-color: #575761; color: white;">Add</button>
            </div>
        </div>

    </div>
    <div th:insert="fragments/menu.html :: menu"> </div>
</body>

</html>